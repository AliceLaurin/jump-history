
<div class = "main_container-dashboard">
  <h1> Welcome <%= @user.first_name %> <%= @user.last_name %>  </h1>
  <div class= "general-trips" >
    <h2>My trips</h2>
    <div class="dashboard-trips">
      <% if @travels.length > 0 %>
      <% @travels.each do |travel| %>
      <div class = "dashboard-trips-description">
          <div class= "dashboard-trips-description-card">
              <%= cl_image_tag travel.picture.key %>
                <h5 class="card-title"><strong><%= travel.name %></strong></h5>
                <%= link_to "See the trip", travel_path(travel) %>
                <% number = travel.bookings.where(status:"pending").all %>
                <% length = number.length %>
                <p class="card-text">You have <strong> <%=length%></strong> pending booking requests for this trip</p>
                  <% if travel.bookings.length > 0 %>
                    <% travel.bookings.each do |booking|%>
                      <% if booking.status == "pending" %>
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item"><%= booking.user.first_name %> <%= booking.user.last_name %>  wants to book this trip from <%= booking.date_of_beginning.strftime("%e %B %Y") %> to <%= booking.date_of_ending.strftime("%e %B %Y") %>
                          <%= link_to "Valider la réservation", booking_path(id: booking.id, status: "validated"), data: {turbo_method: :patch} %>
                          <%= link_to "Refuser la réservation", booking_path(id: booking.id, status: "refused"), data: {turbo_method: :patch} %>
                          </li>
                        </ul>
                        <% elsif booking.status == "validated"%>
                          <p>Booking confirmed on this trip for <%= booking.user.first_name %> <%= booking.user.last_name %> from <%= booking.date_of_beginning.strftime("%e %B %Y") %> to <%= booking.date_of_ending.strftime("%e %B %Y") %></p>
                        <% else %>
                          <p>Booking rejected on this trip for <%= booking.user.first_name %> <%= booking.user.last_name %> from <%= booking.date_of_beginning.strftime("%e %B %Y") %> to <%= booking.date_of_ending.strftime("%e %B %Y") %></p>
                        <% end %>
                      <% end %>
                    <% else  %>
                    <% end %>
                 <% end %>
          </div>
      </div>

    </div>
  </div>
      <p>You have no trip created</p>
    <% else %>
      <%= link_to "Create a trip", new_travel_path%>
    <% end %>
  </div>
  <div class="general-booking">
    <h2>My bookings</h2>
    <div class="dashboard-booking">
          <% if @bookings.length > 0 %>
            <% @bookings.each do |booking| %>
            <div class="dashboard-booking-description">
              <div class="dashboard-booking-description-card">
                <%= cl_image_tag booking.travel.picture.key %>
                    <h5 class="card-title"><strong><%= booking.travel.name%></strong></h5>
                    <p> <em>From <%= booking.date_of_beginning.strftime("%e %B %Y") %> to <%= booking.date_of_ending.strftime("%e %B %Y") %></em></p>
                    <p class="card-text">Booking status :
                      <% if booking.status == "pending" %>
                        <strong>pending</strong>
                      <% elsif booking.status == "validated" %>
                        <strong>confirmed</strong>
                      <% else %>
                        <strong>rejected</strong>
                      <% end %></p>
                    <%= link_to "See the trip", travel_path(booking.travel) %>
              </div>
            </div>
            <% end %>
          <% else %>
            <p>You have no booking</p>
            <%= link_to "Book a new trip", travels_path, class: "btn btn-flat" %>
          <% end %>
      </div>
  </div>
</div>
